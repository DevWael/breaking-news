(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,n=window.wp.element,i=window.wp.components,s=window.wp.data,o=window.wp.editPost,a=window.wp.i18n,r=window.wp.api;var l=e.n(r);const{compose:d}=wp.compose,c=d([(0,s.withSelect)((e=>({postMeta:e("core/editor").getEditedPostAttribute("meta")}))),(0,s.withDispatch)((e=>({setPostMeta(t){e("core/editor").editPost({meta:t})}})))])((e=>{let{postMeta:t,setPostMeta:s}=e;return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(i.PanelRow,null,(0,n.createElement)("div",null,(0,n.createElement)(i.TextControl,{label:(0,a.__)("Custom title","ibn"),value:t.ibn_post_custom_title,onChange:e=>s({ibn_post_custom_title:e})}))))})),{compose:w}=wp.compose,g=w([(0,s.withSelect)((e=>({postMeta:e("core/editor").getEditedPostAttribute("meta")}))),(0,s.withDispatch)((e=>({setPostMeta(t){console.log("setPostMeta",t),e("core/editor").editPost({meta:t})}})))])((e=>{var t;let{postMeta:s,setPostMeta:o}=e;return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(i.PanelRow,null,(0,n.createElement)(i.ToggleControl,{checked:s.ibn_post_expiry_date_toggle,label:(0,a.__)("Set breaking news expiry date","ibn"),help:(0,a.__)("After this date, the post will no longer appear in the breaking news bar","ibn"),onChange:e=>o({ibn_post_expiry_date_toggle:e})})),s.ibn_post_expiry_date_toggle&&(0,n.createElement)(i.PanelRow,null,(0,n.createElement)("div",null,(0,n.createElement)(i.DateTimePicker,{label:(0,a.__)("Expiry Date","ibn"),currentDate:null!==(t=s.ibn_post_expiry_date)&&void 0!==t?t:new Date,onChange:e=>o({ibn_post_expiry_date:e}),isInvalidDate:e=>(e=>e.getTime()<(new Date).getTime())(e),is12Hour:!0,__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0}))))}));class p extends n.Component{constructor(){super(...arguments),this.state={isAPILoaded:!1,editBreakingNews:!1,breakingNewsId:""}}componentDidMount(){(0,s.subscribe)((()=>{const{breakingNewsId:e,editBreakingNews:t}=this.state,n=(0,s.select)("core/editor").isSavingPost();!(0,s.select)("core/editor").isAutosavingPost()&&n&&(t?new(l().models.Settings)({ibn_breaking_news_post_id:e}).save():this.isActiveBreakingNews(e)&&new(l().models.Settings)({ibn_breaking_news_post_id:0}).save())})),l().loadPromise.then((()=>{this.settings=new(l().models.Settings);const{isAPILoaded:e}=this.state;!1===e&&this.settings.fetch().then((e=>{this.setState({breakingNewsId:e.ibn_breaking_news_post_id,editBreakingNews:this.isActiveBreakingNews(e.ibn_breaking_news_post_id),isAPILoaded:!0})}))}))}isActiveBreakingNews(e){const t=(0,s.select)("core/editor").getCurrentPostId();return!!e&&parseInt(e)===t}allowUpdateBreakingNews(e){this.setState({editBreakingNews:e,breakingNewsId:(0,s.select)("core/editor").getCurrentPostId()})}render(){if("post"!==(0,s.select)("core/editor").getCurrentPostType())return null;const{isAPILoaded:e,editBreakingNews:t}=this.state;return e?(0,n.createElement)(o.PluginDocumentSettingPanel,{name:"ibn-breaking-news-metabox",title:(0,a.__)("Breaking News Bar Settings","ibn"),icon:"none",initialOpen:!0},(0,n.createElement)(i.PanelRow,null,(0,n.createElement)(i.ToggleControl,{checked:t,label:(0,a.__)("Mark as breaking news","ibn"),onChange:e=>{this.allowUpdateBreakingNews(e),(0,s.dispatch)("core/editor").editPost({meta:{update_editor:e}})}})),(0,n.createElement)(i.__experimentalDivider,null),(0,n.createElement)(c,null),(0,n.createElement)(i.__experimentalDivider,null),(0,n.createElement)(g,null)):(0,n.createElement)(i.Placeholder,null,(0,n.createElement)(i.Spinner,null))}}(0,t.registerPlugin)("ibn-breaking-news-metabox",{icon:"visibility",render:p})})();